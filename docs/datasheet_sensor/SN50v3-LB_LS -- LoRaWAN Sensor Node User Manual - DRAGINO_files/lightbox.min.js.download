'use strict';define("xwiki-lightbox-messages",{prefix:"core.viewers.attachments.",keys:["date","author"]});define("xwiki-lightbox-config",["jquery"],function(a){var l=JSON.parse(a("#lightbox-config").text());a("body").append(a(l.HTMLTemplate))});
define("xwiki-lightbox-description",["jquery","xwiki-l10n!xwiki-lightbox-messages","moment","moment-jdateformatparser"],function(a,l,p){var h={},m=function(){var c=0<a(".blueimp-gallery-controls").length,d=a("#blueimp-gallery").find(".caption, .title, .publisher, .date").filter((g,k)=>!a(k).is(":empty"));c&&0<d.length?a(".lightboxDescription").css("display","flex"):a(".lightboxDescription").css("display","none")},n=function(c,d){if(c){var g=c.alt==decodeURIComponent(c.href)?"":c.alt;a(".lightboxDescription .caption").html(c.caption||
g||c.title)}a(".lightboxDescription .caption").is(":empty")&&(d&&d.name?a(".lightboxDescription .caption").html(d.name):c&&c.fileName&&a(".lightboxDescription .caption").html(c.fileName))},q=function(c,d){var g=a.Deferred();if(void 0!=h[c])g.resolve(h[c]);else{var k=XWiki.Model.resolve("XWiki.Lightbox.AttachmentMetaDataService",XWiki.EntityType.DOCUMENT);k=(new XWiki.Document(k)).getURL("get","outputSyntax=plain");a.getJSON(k,{imageURL:c}).done(function(b){h[c]=b;g.resolve(b)}).fail(function(){d?
(h[c]={name:d},g.resolve({name:d})):g.reject()})}return g.promise()};a(document).on("click","#blueimp-gallery .slides",m);return{invalidateCachedAttachments:function(){h={}},addSlideDescription:function(c){a(".lightboxDescription .caption").empty();a(".lightboxDescription .title").empty();a(".lightboxDescription .publisher").empty();a(".lightboxDescription .date").empty();m();q(c.href,c.fileName).done(function(d){n(c,d);if(d&&(c.caption&&d.name&&a(".lightboxDescription .title").text(d.name),d.author&&
a(".lightboxDescription .publisher").text(l.get("author",XWiki.Model.resolve(d.author,XWiki.EntityType.DOCUMENT).name)),d.date)){var g=p().toMomentFormatString(a(".lightboxDescription .date").attr("data-dateFormat"));a(".lightboxDescription .date").text(l.get("date",p(d.date).format(g)))}m()}).fail(function(){n(c,void 0);m()})}}});
define("xwiki-lightbox","jquery xwiki-lightbox-description blueimp-gallery xwiki-lightbox-config blueimp-gallery-fullscreen blueimp-gallery-indicator".split(" "),function(a,l,p){var h,m,n,q=function(b,e){e=setTimeout(function(){b.popover("hide")},3E3);a(".popover").on("mouseenter",function(){clearTimeout(e)});a(".popover").on("mouseleave",function(){b.popover("hide")})},c=function(){n.popover({content:function(){return a("#imageToolbarTemplate").html()},html:!0,container:"body",placement:"bottom",
trigger:"manual"}).on("show.bs.popover",function(b){b=b.target;a(".popover").hide();a("#lightboxDownload").attr("href",b.src);a("#lightboxDownload").attr("download",d(b.src));a(".openLightbox").data("index",[...n].indexOf(b))}).on("shown.bs.popover",function(b){a(".popover .imageDownload").attr("href",b.target.src);a(".popover .imageDownload").attr("download",d(b.target.src))}).on("mouseenter",function(){clearTimeout(void 0);a(this).popover("show")}).on("mouseleave",function(){q(a(this),void 0)})},
d=function(b){b=decodeURI((new URL(b)).pathname.split("/").pop());if(/\.[a-zA-Z]*/g.test(b))return b},g=function(){var b=[];n.each(function(){var e=new URL(this.src);var f=new URLSearchParams(e.search);f.delete("width");f.delete("height");e.search=f.toString();e=e.toString();f=a(this);var r=f.closest("figure");0<f.closest("figure").length?(f=r.find("figcaption").html(),f=a("<div></div>").html(f)):f=void 0;r=b.push;var t=new URL(e),u=new URLSearchParams(t.search);u.append("width","150");u.append("height",
"150");t.search=u.toString();r.call(b,{href:e,thumbnail:t.toString(),caption:f,fileName:d(e),alt:a(this).attr("alt"),title:a(this).attr("title")})});return b},k=function(){n=a("#xwikicontent img").filter((b,e)=>0!=a(e.closest("[data-xwiki-lightbox]")).data("xwikiLightbox"));m=g();l.invalidateCachedAttachments();c()};a(document).on("click",".openLightbox",function(){var b={container:"#blueimp-gallery",index:parseInt(a(".openLightbox").data("index")),closeClass:"escape",playPauseClass:"autoPlay",onslide:function(e,
f){e=this.list[e];l.addSlideDescription(e);a(f).find("img").attr("alt",e.alt);a("#lightboxDownload").attr("href",e.href);a("#lightboxDownload").attr("download",e.fileName)}};h=p(m,b)});a(document).on("click","#lightboxFullscreen",function(){a("#lightboxFullscreen").data("open")?(h.exitFullScreen(),a("#lightboxFullscreen").data("open",!1)):(h.requestFullScreen(a("#blueimp-gallery")[0]),a("#lightboxFullscreen").data("open",!0))});a(function(){k()});a(document).on("xwiki:dom:updated",function(){a("#blueimp-gallery").data("isViewMode")&&
k()});a(document).on("xwiki:actions:edit",function(){a("#blueimp-gallery").data("isViewMode",!1);a(".popover").popover("destroy")});a(document).on("xwiki:actions:view",function(){a("#blueimp-gallery").data("isViewMode",!0)})});

//# sourceMappingURL=lightbox.min.js.map
